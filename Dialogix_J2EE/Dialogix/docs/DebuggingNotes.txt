9/25/2007

Re-commented all Evidence code so that only TricepsTimingCalculator is called:

Errors
(1) RawData not updated
(2) EnglishFrenchDemo not updated
(3) InstrumentSession not updated
(4) PageHitEvents - only partially updated
(5) PageHit updated, but wrong times

Instrument_Session_ID is 0 before most errors

Updates do occur (enough? - compare to without comments) - is problem just session ID?

-----
9/26/2007

data.MysqlInstrumentSessionDAO->setInstrumentSession:63 - instrument_id = 0 - is that session? instrument?

-----
9/30/2007

Unicode Debugging Notes
(1) MySQL does accurately store Unicode text (russian, Hebrew) if use PHPMyadmin to enter and save it.  So Mysql will be fine once can load proper data into it.
(2) Velocity Macros also print proper text (so Java Parser is working)
(3) .dat files show proper Unicode (whether using UTF-16 or UTF-8)
(4) .dat.evt are wrong - JavaScript 1.2 (the version I was using) does not support Unicode. When I declare JavaScript 1.5, no change
(5) Need to test Mysql drivers for unicode compatability (e.g. load results of Velocity Macros into a table
(6) Entering UTF-8 into any input field (text, memo) yields wrong answer.  Unicode in non-text fieds is fine, but may be due to using internal coded values in return statements
(5) 

------
10/5/2007

Database Writing
- Seems to be largely fixed (no NullPointerException; one row per desired session; updates are happening)
- However, there are many wrong or missing values which need to be corrected
- Make sure to CVS this before doing much more!

Unicode
- UTF-16 to Log4J let me see some contents correctly, confirming that error is not on Log4J side

------
10/7/2007

Notes from running the Gary's revised code

(1) EnglishRussianFrenchHebrew
(2) InstrumentSession
(3) PageHitEvents
(4) PageHits
(5) RawData

-- Note, can't use on update CURRENT_TIMESTAMP on two rows, so application must enforce accurate start and end times.
-- N.B.  Focus on InstrumentSession, InstrumentSessionData, and RawData - Ignore PageHits and PageHitEvents for now!!!!

// InstrumentSessionDataDAO
englishrussianfrenchhebrew
  InstrumentName - OK
  InstanceName - OK
  StartTime - OK 
  end_time - OK
  first_group - OK
  last_group - OK
  last_action - OK
  status_message - OK
  instrument_session_id - OK
  <DisplayNum> - OK

// InstrumentSessionDAO
instrument_session
  instrument_session_id - OK
  start_time - OK
  end_time - OK
  instrument_id - OK
  instrument_version_id - OK
  user_id - OK (but N/A)	/skip
  first_group - OK
  last_group - OK
  last_action - OK
  statusMsg - OK
  <DisplayNum> - OK

// PageHitEventsDAO (?)
pagehitevents 
  pageHitEventsID - OK
  pageHitID - OK	
  varName - OK
  actionType - OK
  eventType - OK
  `timestamp` - OK
  duration - OK
  value1 - OK	// except no Unicode, and change events aren't showing the final value after series of keypresses
  value2 - OK	// except no Unicode

// PageHitsDAO (?)
pagehits 
  pageHitID - OK
  instrument_session_id - OK (always 0)	/FIXME
  `timeStamp` - OK
  groupNum - OK	/FIXME (is it really OK?)
  displayNum - OK - at least first several are - accessCount is better	/FIXME
  lastAction - OK (but present)	/skip
  statusMsg - OK
  totalDuration - WRONG (huge)	/FIXME (last entry in EVENT_TIMING)
  serverDuration - WRONG (huge)	/FIXME (computed from TricepsTimingCalculator)
  loadDuration - OK (? - < 100 ms, which seems right)
  networkDuration - ?? (= 0, but working on localhost)	/FIXME (check calculation)
  pageVacillation - WRONG (always 1)	/was this so can do SQL to add # of hits?

// MysqlRawDataDAO
// Set from TTC - exclusively from writeNode?
rawdata 
  RawDataID	- OK
  instrument_session_id - OK
  InstrumentName - OK
  InstanceName - OK
  VarName - OK
  VarNum - BAD - always -1 - but is this really used?	/skip
  GroupNum - OK - it is using DisplayNum	/FIXME (but could be done within InstumentModel on load
  DisplayNum - OK 
  LangNum - OK, but using number from list of languages - should really use the Java ISO code (like "en" or "ru")	/FIXME (from InstrumentLoad)
  WhenAsMS - OK
  `TimeStamp` - OK, but do we really need both (is there an easy conversion between WhenAsMS and TimeStamp
  AnswerType - OK
  Answer - OK, but Unicode part not working.  The NullFlavor part is (*REFUSED*, *UNASKED*, etc.)	/FIXME (Unicode part)
  QuestionAsAsked - OK, but Unicode part not working	/FIXME (unicode part)
  itemVacillation - BAD - always 0	/FIXME - count # change events for a variable within EVENT_TIMING
  responseLatency - BAD - always 0	/FIXME - for a variable, time from focus to next event (as long as next event is not blur)
	// EventAggregate
	// // Evidence - from qtb 
	// PageHitBean (calls EventAggregate - the only function which calls it, via processEvents())
	// QuestionTimingBean (but not used)?
	// TricepsTimingCalculator (using QTB, but not set) (supposed to be?)
	// PageHitBean.processEvents() - it's store() called from TTC
  responseDuration - BAD - always 0	/FIXME - for a variable, time from focus to blur
  nullFlavor - BAD - always 0	/skip
  `Comment` - OK
  <crosspageItemVacillation> - ADD - Assuming have an in-memory representation of data (one row per item), increment it each time an item visited (changed? both?)

[FIXED] Concurrency - when trying to run two simultaneous sessions, they got confused - why?
---
10/9/2007

Unicode Debugging Notes
(1) MySQL does accurately store Unicode text (russian, Hebrew) if use PHPMyadmin to enter and save it.  So Mysql will be fine once can load proper data into it.
(2) Velocity Macros also print proper text (so Java Parser is working)
(3) .dat files OK
(4) .dat.evt files OK
(5) Entering unicode (Russian, Hebrew) into Dialogix data entry fields yields expected value - SO, Sufficiently working?
(6) Test jar/unjar of data - OK
(7) Test jar/unjar of instruments - BAD - when restore, the character values are wrong (but can avoid this by forcing use of .txt files

---
10/16/2007

Removed obsolete DB access parameters, interfaces and Beans (now 72 files)
Added DisplayNum to InstrumentSession and InstrumentSessionData tables

---
10/17/2007

[DONE] Check workflow - .store() events seem to occur at wrong time.  Page and Instrument should store right before returning to user?
[DONE] Fix lastAccess, statusMsg
[DONE] Confirm using correct GroupNum for pageHits and RawData
[DONE] Fix naming of groups - startingGroup, currentGroup, fromGroup, toGroup
[DONE] Fix naming of end_time => lastAccessTime
[DONE] Test concurrency - OK (as long as separate browsers, and thus separate sessions
[DONE] Removed delete() from all DB calls

	[DONE] Remove InstrumentName from rawData and horizontal table (keep in Instrument)
	[DONE] Remove InstanceName from rawData and horizontal table (keep in Instrument)
	[DONE] Change table names to InstVer_NNNN (rather than  QAM, etc.) (instrumentVersion.instance_table_name)
	[DONE] Convert LangNum to LangCode (see Schedules.languagesISO)
	[DONE] Add LangCode to pageHits, InstrumentSession, HorizontalTable, and RawData to know what to expect
	
-----
-- Notes from 10/31/2007
----
Critical ToDos
==TOM==
[DONE] Finish persisting of full model from DialogixTimingCalculator
  [DONE] Horizontal Table 
  [DONE] DataElement - created, but not updated - do I need to add new objects?  Change persistence type? -- Check that data are being added -- also fix InstrumentContent_ID
  [DONE] PageUsage?
  [DONE] PageUsageEvents?
  [DONE] ItemUsage - fix InstrumentContent_ID
[DONE] Fix uniqueness constraints for Instrument, InstrumentVersion -- Annotate for George
[DONE] Create Inst_Ver_x table wheen upload a new InstrumentVersion (manually roll query) --in ExcelLoader
[DONE] Fix Sequence_Generator so only refers to tables being updated (e.g. remove InstVer4) -- do last 
[DONE] Complete round-trip - upload Excel, collect data - both using JPA -- so populate ItemContents, etc. from Global Definition -- test that can load  instrument and populate DialogixTimingCalculator from InstrumentVersion ID
[ ] Consider re-naming classes?
  - InstrumentContents => Acts
  - ItemType => ActType
  - Item => Act
  - AnswerListContent => AnswerListEntry
[DONE] Re-do Entities to

Test Instruments
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\DISC-combined.xls -- throws NullPointer - why?
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\English-Russian-French-Hebrew-Demo.xls	-- works
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\PHQ.xls -- NO - throws NullPointer
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\SF-36.xls -- throws NullPointer -- are the questions too long?
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Test.xls -- works
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Test2.xls -- NO - NullPointer (after success with EnglishHebrew and Test.xls)

==GEORGE=
[ ] CCD Writer using SNOMED mapping codes

Optional Tasks
[ ] Map to XForms
[ ] Map to VoiceXML
[ ] Review ISO 11179 metadata issues - should any be  added to what we have?

Lingering WishList
[ ] Stress testing? (to profile for potential leaks?)
[ ] What will it take to replace current Dialogix install with new one (on www.dialogix.org)?
[ ] Replace wave6users table? (Study - user, instrument - will then point to InstrumentSession?)
[ ] What is lift to remove Datum and use DataElement within Parser?

Wishlist of Views / Actions
- Uplaod Instrument - use button with Explorer window
 - will say whether successful or not - possibly a message saying user needs to create new version #
 - show a link to lauch and debug the instrument
- Select Instrument from list - pull from Instrument, InstrumentVersion, InstrumentHash - generate HTTP GET command to launch instrument
        http://www.dialogix.org:8080/BYS/servlet/Dialogix?schedule=BYS/WEB-INF/schedules/BYS-Adult.txt&DIRECTIVE=START
- LOINC 6 axes editting [optional]
 Property = FINDING, Time=PT, System=^PATIENT, Scale=dataType.LoincScale, Method=OBSERVED

- 

-- APELON --

TQL Export
	FROM [ROSI] EXPORT_CONCEPTS; 
		-- have to manually set save location for XML
		-- may not export SNOMED-specific parameters
	FROM [Instruments] EXPORT_NAMESPACE; 
		
C:\cvs5\Dialogix2007\Dialogix_Gary\docs\instruments_with_mappings.xml		
		
		
Mapping

NameSpace = Instruments

Instrument.*
 InstrumentVersion.* (LOINC panel) [InstrumentVersion_ID]
  InstrumentContent.* (sequence) [call Actions instead of InstrumentContent?]
   Item.* (LOINC) [Item_ID] [call Action]
    Question 
     QuestionLocalized.*
    ItemType (Q,E) [ActionType - Item, Equation, Instruction]
    DataType (determines whether has AnswerList) [Optional if Instrruction]
    AnswerList
     AnswerListContent [call AnswerListEntry?]
      Answer.* (LAcode)[Answer_ID]
       AnswerLocalized.*
      AnswerOrder
      Value
   VarName [Property]
   Relevance [Property]
   
Contains vs. ContainedBy
Property Of (attribute)
Associated xxx (attribute)

Binding
 A =>
 Q =>
 QA =>
 IQA =>
 


   
   
 =====
 Notes for PHP Queries for George

--
-- Get all localized questions for a given Item
--
 
SELECT item.item_ID, item.itemType, question_localized.LanguageCode, question_localized.QuestionString
FROM item, question, question_localized
WHERE item.Question_ID = question.Question_ID
AND question_localized.question_ID = question.Question_ID
ORDER BY item.item_ID, question_localized.LanguageCode

--
-- Get all Answers and Values for items which have AnswerLists
--


SELECT item.item_ID, item.itemType, answer_list_content.AnswerOrder, answer_list_content.Value, answer_localized.LanguageCode, answer_localized.AnswerString
FROM item, answer_list, answer_list_content, answer,answer_localized
WHERE item.AnswerList_ID = answer_list.AnswerList_ID
and answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
and answer_list_content.Answer_ID = answer.Answer_ID
and answer.Answer_ID = answer_localized.Answer_ID
ORDER BY item.item_ID, answer_list_content.AnswerOrder, answer_localized.LanguageCode;

--
-- Get all unique AnswerLists
--


SELECT answer_list.AnswerList_ID, answer_localized.LanguageCode, answer_list_content.AnswerOrder, answer_list_content.Value, answer_localized.AnswerString
FROM answer_list, answer_list_content, answer,answer_localized
WHERE 
answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
and answer_list_content.Answer_ID = answer.Answer_ID
and answer.Answer_ID = answer_localized.Answer_ID
ORDER BY answer_list.AnswerList_ID, answer_localized.LanguageCode, answer_list_content.AnswerOrder;

-- Same, but just for English

SELECT answer_list.AnswerList_ID, answer_localized.LanguageCode, answer_list_content.AnswerOrder, answer_list_content.Value, answer_localized.AnswerString
FROM answer_list, answer_list_content, answer,answer_localized
WHERE 
answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
and answer_list_content.Answer_ID = answer.Answer_ID
and answer.Answer_ID = answer_localized.Answer_ID
AND answer_localized.LanguageCode = 'en'
ORDER BY answer_list.AnswerList_ID, answer_localized.LanguageCode, answer_list_content.AnswerOrder;

-- Find unique answerLists

SELECT answer_list_content.AnswerList_ID, answer_list_content.answer_ID, answer_list_content.AnswerOrder, answer_list_content.Value,
	answer_localized.AnswerString
FROM answer_list_content, answer, answer_localized
WHERE answer_list_content.Answer_ID = answer.Answer_ID
	AND answer.Answer_ID = answer_localized.Answer_ID
	AND answer_localized.LanguageCode = 'en'
ORDER BY answer_list_content.AnswerList_ID, answer_list_content.AnswerOrder;

-- Find unique AnswerLists

SELECT answer_list_content.AnswerList_ID, answer_list_content.answer_ID, answer_list_content.AnswerOrder, answer_list_content.Value
FROM answer_list_content, answer
WHERE answer_list_content.Answer_ID = answer.Answer_ID
ORDER BY answer_list_content.AnswerList_ID, answer_list_content.AnswerOrder;

-- N.B. There are too many Answer_IDs for the number of localized strings.

--
-- Get all Questions, Answers and Values for items which have AnswerLists
--


SELECT item.item_ID, question_localized.LanguageCode, question_localized.QuestionString, answer_list_content.AnswerOrder, answer_list_content.Value, answer_localized.LanguageCode, answer_localized.AnswerString
FROM item, question, question_localized, answer_list, answer_list_content, answer,answer_localized
WHERE item.AnswerList_ID = answer_list.AnswerList_ID
and answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
and answer_list_content.Answer_ID = answer.Answer_ID
and answer.Answer_ID = answer_localized.Answer_ID
and item.Question_ID = question.Question_ID
and question_localized.question_ID = question.Question_ID
and question_localized.LanguageCode = answer_localized.LanguageCode
ORDER BY item.item_ID, question_localized.LanguageCode, answer_list_content.AnswerOrder, answer_localized.LanguageCode;

-- Same, but just for English

SELECT item.item_ID, question_localized.LanguageCode, question_localized.QuestionString, answer_list_content.AnswerOrder, answer_list_content.Value, answer_localized.LanguageCode, answer_localized.AnswerString
FROM item, question, question_localized, answer_list, answer_list_content, answer,answer_localized
WHERE item.AnswerList_ID = answer_list.AnswerList_ID
and answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
and answer_list_content.Answer_ID = answer.Answer_ID
and answer.Answer_ID = answer_localized.Answer_ID
and item.Question_ID = question.Question_ID
and question_localized.question_ID = question.Question_ID
and question_localized.LanguageCode = answer_localized.LanguageCode
and answer_localized.LanguageCode = 'en'
ORDER BY item.item_ID, question_localized.LanguageCode, answer_list_content.AnswerOrder, answer_localized.LanguageCode;


--
-- Get Session results
--

SELECT data_element.LanguageCode, data_element.QuestionAsAsked, data_element.AnswerString, 
	data_element.Answer_ID, answer_localized.AnswerString
FROM data_element, instrument_content, instrument_session, answer_localized
WHERE data_element.InstrumentContent_ID = instrument_content.InstrumentContent_ID
	AND answer_localized.Answer_ID = data_element.Answer_ID
	AND answer_localized.LanguageCode = 'en'
	AND instrument_session.InstrumentSession_ID = 1
ORDER BY data_element.DataElementSequence;

--
--  Compare AnswerID values computed by system to list of actuals for data from a session
--

SELECT data_element.DataElementSequence, data_element.QuestionAsAsked, question_localized.QuestionString, data_element.AnswerString, data_element.Answer_ID,
	answer_list_content.Answer_ID as AnsID, answer_list_content.AnswerOrder, answer_list_content.Value, answer_localized.AnswerString
FROM data_element, instrument_content, item, question, question_localized, answer_list, answer_list_content, answer, answer_localized
WHERE data_element.InstrumentSession_ID = 4				-- select the desired Session # here
	AND data_element.InstrumentContent_ID = instrument_content.InstrumentContent_ID
	AND instrument_content.Item_ID = item.Item_ID
	AND item.Question_ID = question.Question_ID
		AND question.Question_ID = question_localized.Question_ID
		AND question_localized.LanguageCode = 'en'
	AND item.AnswerList_ID = answer_list.AnswerList_ID
	AND answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
	AND answer_list_content.Answer_ID = answer.Answer_ID
		AND answer.Answer_ID = answer_localized.Answer_ID
		AND answer_localized.LanguageCode = 'en'
ORDER BY data_element.DataElementSequence, answer_list_content.Value

-- Same, but only "actual" values

SELECT data_element.DataElementSequence, data_element.QuestionAsAsked, question_localized.QuestionString, data_element.AnswerString, data_element.Answer_ID,
	answer_list_content.AnswerOrder, answer_localized.AnswerString
FROM data_element, instrument_content, item, question, question_localized, answer_list, answer_list_content, answer, answer_localized
WHERE data_element.InstrumentSession_ID = 4				-- select the desired Session # here
	AND data_element.InstrumentContent_ID = instrument_content.InstrumentContent_ID
	AND instrument_content.Item_ID = item.Item_ID
	AND item.Question_ID = question.Question_ID
		AND question.Question_ID = question_localized.Question_ID
		AND question_localized.LanguageCode = 'en'
	AND item.AnswerList_ID = answer_list.AnswerList_ID
	AND answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
	AND answer_list_content.Answer_ID = answer.Answer_ID
		AND answer.Answer_ID = answer_localized.Answer_ID
		AND answer_localized.LanguageCode = 'en'
	AND data_element.AnswerString = answer_list_content.Value
ORDER BY data_element.DataElementSequence, answer_list_content.Value


--
--  Compare AnswerID values computed by system to list of actuals for data from a session
--

SELECT item_usage.ItemUsageSequence, item_usage.QuestionAsAsked, question_localized.QuestionString, item_usage.AnswerString, item_usage.Answer_ID,
	answer_list_content.Answer_ID as AnsID, answer_list_content.AnswerOrder, answer_list_content.Value, answer_localized.AnswerString
FROM item_usage, instrument_content, item, question, question_localized, answer_list, answer_list_content, answer, answer_localized
WHERE item_usage.InstrumentSession_ID = 4				-- select the desired Session # here
	AND item_usage.InstrumentContent_ID = instrument_content.InstrumentContent_ID
	AND instrument_content.Item_ID = item.Item_ID
	AND item.Question_ID = question.Question_ID
		AND question.Question_ID = question_localized.Question_ID
		AND question_localized.LanguageCode = 'en'
	AND item.AnswerList_ID = answer_list.AnswerList_ID
	AND answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
	AND answer_list_content.Answer_ID = answer.Answer_ID
		AND answer.Answer_ID = answer_localized.Answer_ID
		AND answer_localized.LanguageCode = 'en'
ORDER BY item_usage.ItemUsageSequence, answer_list_content.Value

--
-- Same, but "actual" found values
--
SELECT item_usage.ItemUsageSequence, item_usage.QuestionAsAsked, question_localized.QuestionString, item_usage.AnswerString, item_usage.Answer_ID,
	answer_list_content.AnswerOrder, answer_localized.AnswerString
FROM item_usage, instrument_content, item, question, question_localized, answer_list, answer_list_content, answer, answer_localized
WHERE item_usage.InstrumentSession_ID = 4				-- select the desired Session # here
	AND item_usage.InstrumentContent_ID = instrument_content.InstrumentContent_ID
	AND instrument_content.Item_ID = item.Item_ID
	AND item.Question_ID = question.Question_ID
		AND question.Question_ID = question_localized.Question_ID
		AND question_localized.LanguageCode = 'en'
	AND item.AnswerList_ID = answer_list.AnswerList_ID
	AND answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
	AND answer_list_content.Answer_ID = answer.Answer_ID
		AND answer.Answer_ID = answer_localized.Answer_ID
		AND answer_localized.LanguageCode = 'en'
	AND item_usage.AnswerString = answer_list_content.Value
ORDER BY item_usage.ItemUsageSequence, answer_list_content.Value

===
== MDS Info
==
(1) On average, there are 2 MDS coordinators per Nursing Home
(2) There are between 16K and 17K nursing homes (was it thousand, or hundred)?
(3) If each coordinator makes $50K, then total cost of that staffing is 30k * 1650 * 2 - so $99 million (or 990 million) spent on that role which could be re-directed to care.

==
== Notes and ToDos from 11/5/07
==
[ ] Outline Tutorial to identify gaps
 - Identify all use cases I want to show
 - Ensure I cover everything listed in the prospectus
 - Now that I know that Items won't be unique, how do I modify the demo? 
[DONE - see below] Assess what works/doesn't in Dialogix -  esp. re: uniqueness
[DONE] Map  Abt instruments to Dialogix so can load them
[ ] Create DB-free version for uploading and testing.  Once all syntax errors removed, then upload to DB (extract prior version of ExcelLoader as new class)
[ ] Map to XForms?
[ ] Review eDCI model?
[ ] Review ISO 11179 attributes
[ ] Create and test Apelon model
[ ] Verify how will re-import mappings into Dialogix

== NOTES on Import Issues
[DONE] Want to re-use Items - how do I know if it the same as an existing one? - ParseItem passing all needed parameters? -- SKIP- too hard for now
	parseQuestion()?	- need a new ID if none exists; but re-use it if possible
	parseAnswer()? - need a new ID if none exists; but re-use it possible - this assumes that if additional languages are added, the user put thought into proper translation; but this may not be true.
	parseAnswerList() - should be global
	parseItem(Question, ...) - should be global
	parseInstrumentContent() -- NO, these don't need to be unique?
	[ ] Modeling problem - should AnswerListContent be unique, or re-used within AnswerLists?  I can't currently detect unique AnswerLists
	I'm not re-using Items - needs to be fixed, but when?

== Instrument Use - Which fields still aren't being set properly?
InstrumentSession.languageCode
DataElement.languageCode
DataElement.Answer_ID - confirm this.  Seems wrong!!!! 
	- This is critical.  TimingCalculator.FindAnswerID.  Works for English-Hebrew, but not for PHQ - why not?  
	- The raw data is correct, but the mapping to AnswerID is wrong
	- Can this be retrieved from elsewhere?
	- Is it not loading referential integrity of AnswerLists properly?
DataElement.ResponseLatency
DataElement.ResponseDuration
DataElement.DisplayNum (set to 1 for  setting Unasked - those should be 0)
DataElement.NullFlavorID (should be  non-zero for UNASKED)
ItemUsage.ItemVacillation
ItemUsage.ResponseLatency
ItemUsage.ResponseDuration
ItemUsage.Answer_ID -- wrong! but same solution as DataElement
PageUsage.FromGroupNum - always 0
Pageusage.pageDuration
Pageusage.pageVacillation
Pageusage.LanguageCode 
InstrumentSession.LanguageCode

===
AnswerList - what If I add answer_list_denormalized using Dialogix syntax?  [silly, silly, you're doing it!]

NOTES
(1) Throws no errors and does re-use Items, but too many of them (only first AnswerList ever used)
(2) Content appears to be loaded in memory, but not persisted -- are the wrong objects connected?  Is findItem() mis-aligning them?

== Notes from 11/6/07 ==
Action Items
[ ] Add AuthorizedUsers table to Dialogix5


PHP Views
(0) Upload
	- Upload to Dev - do in Velocity or Java Servlet - need code snipped to attach Uploaded file so get filename to submit to Velocity Macro (or InputExcelLoader)
	- Upload to Prod - same, but to database version of Dialogix
(1) Instruments - by title, version - with descriptive statistics.  
	Min = (instrumentHash.numQuestions - instrumentHash.numTailorings); Max = (instrumentHash.numQuestions)
	Name hyperlink - should launch the instrument (look at parser for launch command)
(2)Instruments (InstrumentDetails.php) - 
  ID => LOINC
  
			-- 
			-- LOINC View for Item Submissions
			-- This shows most of information needed for LOINC
			--
			
				SELECT item.item_ID, question_localized.QuestionString, answer_list_content.AnswerOrder, answer_list_content.Value, answer_localized.AnswerString, question.Question_ID, answer.Answer_ID,
					question_localized.QuestionString as Component,
					'FINDING' as Property,
					'PT' as TimeAspect,
					'^PATIENT' as System,
					'NOM' as Scale,
					'OBSERVED' as Method
				FROM item, question, question_localized, answer_list, answer_list_content, answer, answer_localized
				WHERE item.AnswerList_ID = answer_list.AnswerList_ID
				and answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
				and answer_list_content.Answer_ID = answer.Answer_ID
				and answer.Answer_ID = answer_localized.Answer_ID
				and item.Question_ID = question.Question_ID
				and question_localized.question_ID = question.Question_ID
				and question_localized.LanguageCode = answer_localized.LanguageCode
				and answer_localized.LanguageCode = 'en'
				ORDER BY item.item_ID, question_localized.LanguageCode, answer_list_content.AnswerOrder, answer_localized.LanguageCode;
		
		[ ] N.B. LOINCscale must be linkable to Item without going through displayType?
  
  Name => Logic File
  Language => Translation File (skip unless can fix AnswerNormalized)
  *Apelon - point to static file - point to /bin/tomcat6/bin/webapps/Demos/WEB-INF/schedules/inst_ver_#.apelon.xml
  XML - skip
  Voice - skip
  XForms - skip
(3) Results (InstrumentSearch.php)
	ID => LOINC -- pull ID from InstrumentVersion_ID
	Name => Logic File
	Results => horizontal tables (so need to know inst_ver_{InstrumentVersion_ID}) [OK]
	Recap => (InstanceSearch.php) - list sessions for that InstrumentVersion
	Changes => Skip (from data_element)
	Per-Screen => skip (from pageUsage)
	Per-Var => skip (from ItemUsage)
	*SPSS => skip
	*SAS => skip
(4) InstanceSearch.php
	Pass InstrumentVersion_ID instead of InsturmentName
	remove Filename
	Link from NumpagesViewed to actual results (ShowInstrumentData.php)
	Add instrumentSession.StatusMsg
	Add instrumentSession.LastAccessTime
(5) ShowInstrumentData.php
	Pass InstrumentSession_ID
	*All Results 
	
		Query 1 - All results
			VarName, QuestionAsAsked, AnswerCode, AnswerString, AnswerID 
			
		SELECT var_name.VarName, item_usage.QuestionAsAsked, item_usage.AnswerString as AnswerCode, item_usage.Answer_ID
		FROM item_usage, var_name
		WHERE item_usage.InstrumentSession_ID = 3				-- select the desired Session # here
			AND item_usage.VarName_ID = var_name.VarName_ID
			AND item_usage.AnswerString not like '*UNASKED*'
		ORDER BY item_usage.ItemUsageSequence 
		
	*Results with Coded Answers
		
		Query 2 - All results which have Answer_ID	
			VarName, QuestionAsAsked, AnswerCode, AnswerString, AnswerID 
			
		SELECT var_name.VarName, item_usage.QuestionAsAsked, item_usage.AnswerString as AnswerCode, answer_localized.AnswerString, item_usage.Answer_ID
		FROM item_usage, instrument_content, item, answer_list, answer_list_content, answer, answer_localized, var_name
		WHERE item_usage.InstrumentSession_ID = 3				-- select the desired Session # here
			AND item_usage.InstrumentContent_ID = instrument_content.InstrumentContent_ID
			AND instrument_content.Item_ID = item.Item_ID
			AND item.AnswerList_ID = answer_list.AnswerList_ID
			AND answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
			AND answer_list_content.Answer_ID = answer.Answer_ID
				AND answer.Answer_ID = answer_localized.Answer_ID
				AND answer_localized.LanguageCode = 'en'
			AND item_usage.AnswerString = answer_list_content.Value
			AND item_usage.VarName_ID = var_name.VarName_ID
		ORDER BY item_usage.ItemUsageSequence 
		
		-- If want full set of ansewrs, optionally with coded values, need union, or inner query

	*HL72.5 - color code the contents, and generate a real HL7 2.5 message
	
		SELECT var_name.VarName, item_usage.QuestionAsAsked, item_usage.AnswerString as AnswerCode, answer_localized.AnswerString,
			instrument_session.InstrumentVersion_ID, instrument.InstrumentName, instrument_version.VersionString, item.Item_ID, question.Question_ID, question_localized.QuestionString as QuestionSource, item_usage.Answer_ID,
			CONCAT(instrument_session.InstrumentVersion_ID, '^', instrument.InstrumentName, '^',  instrument_version.VersionString, '^L') as OBR4,
			CONCAT(question.Question_ID, '^', question_localized.QuestionString, '^L^', var_name.VarName, '^', item_usage.QuestionAsAsked, '^L') as OBX3,
			CONCAT(item_usage.Answer_ID, '^', answer_localized.AnswerString, '^L^', item_usage.AnswerString, '^', answer_localized.AnswerString, '^L') as OBX5	
		FROM item_usage, instrument_content, item, question, question_localized, answer_list, answer_list_content, answer, answer_localized, var_name, instrument, instrument_version, instrument_session
		WHERE item_usage.InstrumentSession_ID = 3
			AND instrument_session.InstrumentSession_ID = item_usage.InstrumentSession_ID
			AND instrument_session.InstrumentVersion_ID = instrument_version.InstrumentVersion_ID
			AND instrument_version.Instrument_ID = instrument.Instrument_ID
			AND item_usage.InstrumentContent_ID = instrument_content.InstrumentContent_ID
			AND instrument_content.Item_ID = item.Item_ID
			AND item.Question_ID = question.Question_ID
				AND question.Question_ID = question_localized.Question_ID
				AND question_localized.LanguageCode = 'en'
			AND item.AnswerList_ID = answer_list.AnswerList_ID
			AND answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
			AND answer_list_content.Answer_ID = answer.Answer_ID
				AND answer.Answer_ID = answer_localized.Answer_ID
				AND answer_localized.LanguageCode = 'en'
			AND item_usage.AnswerString = answer_list_content.Value
			AND item_usage.VarName_ID = var_name.VarName_ID
		ORDER BY item_usage.ItemUsageSequence
		
	*CCD - color code template
	
		-- 
		-- Dumping data for table 'code_system'
		-- 
		
		INSERT INTO code_system (CodeSystem_ID, CodeSystemName, CodeSystemOID) VALUES 
		(1, 'LOINC', '2.16.840.1.113883.6.1'),
		(2, 'SNOMED-CT', '2.16.840.1.113883.6.96');
		
		-- 
		-- Dumping data for table 'semantic_mapping_q_a'
		-- 
		
		INSERT INTO semantic_mapping_q_a (SemanticMapping_QA_ID, Question_ID, Answer_ID, CodeSystem_ID, Code, CodeDisplayName) VALUES 
		(1, 8, 7, 2, 'F-90156', 'Unable to use decision making strategies (finding)'),
		(2, 8, 7, 1, 'LA0000000059', 'MODERATELY IMPAIRED-decisions poor, cues/supervision required');		
	

		SELECT var_name.VarName, item_usage.QuestionAsAsked, item_usage.AnswerString as AnswerCode, answer_localized.AnswerString,
			instrument_session.InstrumentVersion_ID, instrument.InstrumentName, instrument_version.VersionString, item.Item_ID, question.Question_ID, question_localized.QuestionString as QuestionSource, item_usage.Answer_ID,
			semantic_mapping_q_a.code, code_system.CodeSystemName, code_system.CodeSystemOID, semantic_mapping_q_a.CodeDisplayName
		FROM item_usage, instrument_content, item, question, question_localized, answer_list, answer_list_content, answer, answer_localized, var_name, instrument, instrument_version, instrument_session, semantic_mapping_q_a, code_system
		WHERE item_usage.InstrumentSession_ID = 3
			AND instrument_session.InstrumentSession_ID = item_usage.InstrumentSession_ID
			AND instrument_session.InstrumentVersion_ID = instrument_version.InstrumentVersion_ID
			AND instrument_version.Instrument_ID = instrument.Instrument_ID
			AND item_usage.InstrumentContent_ID = instrument_content.InstrumentContent_ID
			AND instrument_content.Item_ID = item.Item_ID
			AND item.Question_ID = question.Question_ID
				AND question.Question_ID = question_localized.Question_ID
				AND question_localized.LanguageCode = 'en'
			AND item.AnswerList_ID = answer_list.AnswerList_ID
			AND answer_list.AnswerList_ID = answer_list_content.AnswerList_ID
			AND answer_list_content.Answer_ID = answer.Answer_ID
				AND answer.Answer_ID = answer_localized.Answer_ID
				AND answer_localized.LanguageCode = 'en'
			AND item_usage.AnswerString = answer_list_content.Value
			AND item_usage.AnswerString = answer_list_content.Value
			AND item_usage.VarName_ID = var_name.VarName_ID
			AND semantic_mapping_q_a.Question_ID = item.Question_ID
			AND semantic_mapping_q_a.Answer_ID = answer.Answer_ID
			AND semantic_mapping_q_a.CodeSystem_ID = code_system.CodeSystem_ID
		ORDER BY item_usage.ItemUsageSequence


==
Notes for Tutorial Presentation
==

Slides from George:
(1) Flow of data to/from Dialogix/DTS/LOINC/SNOMED/UMLS - sequence diagram
(2) Architecture?
(3) Database Diagram for dialogix vs. LOINC?

==
11/7/07
==
Apelon
(1) Create new Namespace
(2) Run import wizard
C:\cvs5\Dialogix2007\Dialogix_Gary\docs\instrument-dialogix3.xml
C:\cvs5\Dialogix2007\Dialogix_Gary\docs\test.xml

== Test TQL Exports
		
FROM [Instruments] 
	WITH "Maps To (Question)" EXISTS
	EXPORT InstrumentVersion_ID, Item_ID, Question_ID, QuestionString, "Maps To (Question)", "Maps To (Question)"->NAMESPACE;
		
FROM [Instruments] 
	WITH "Maps To (Answer)" EXISTS
	EXPORT Answer_ID, AnswerString, "Maps To (Answer)", "Maps To (Answer)"->NAMESPACE;
	
FROM [Instruments]
	WITH "Maps To (Question)" EXISTS
	EXPORT InstrumentVersion_ID, ItemVarName, InstrumentContent_ID, Item_ID, Question_ID, Answer_ID, QuestionString, AnswerString, "Maps To (Question)", "Maps To (Question)"."Mapping Quality", PARENT->NAMESPACE, "Maps To (Question)"->NAMESPACE;

[ ] Add slot to let users record the actual SNOMED code
[ ] Add new template which shows exactly what is needed for mapping (including enumerated lists)

==
[ ] FIXME - when load French/English Demo
(1) inst_ver_x is OK
(2) data_element created, but not updated
(3) item_usage not created
(4) page_usage, and page_usage_event not created

C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Adult Needs and Strengths Assessment (ANSA).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\AUDIT - Alcohol Use Disorders Identification Test- Interview Version.xls
	C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Alcohol Use Scale (AUS).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Blessed Dementia Scale.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Brief Psychiatric Rating Scale (BPRS) Version 4.0.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\California Quality of Life (CA-QOL).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\CAGE.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Child and Adolescent Needs and Strengths (CANS-MH).xls
	C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Drug Use Scale.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Geriatric Depression Scale.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Mental Health Recovery Measure (MHRM).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\MHSIP Adult Consumer Survey (Draft Version 1.2, February 17, 2006) - Email Format.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Draft MHSIP Consumer Youth Survey For Families (YSS-F, 2006) - rapid entry.xls
	C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Ohio Mental Health Consumer Outcomes System Ohio Youth Problem, Parent Rating .xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Ohio Mental Health Consumer Outcomes System Ohio Youth Problem, Functioning, and Satisfaction Scales.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Ohio Mental Health Consumer Outcomes System Ohio Youth Problem, Functioning, And Satisfaction Scales W.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Patient Health Questionnaire (PHQ-9).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Physical Self Maintenance Scale (PSMS) -- Patient version.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\ROSI.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Symptom Checklist-90-R (SCL-90-R) version SCL-10-R.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\SOCRATES v8.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Symptom Checklist-90-R (SCL-90-R) SCL-6.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\The Making Decisions Empowerment Scale.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\The Caregiver Strain Index.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Symptom Distress Scale (adapted from SCL-90 and BSI).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\SF-36.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\DISC-combined.xls

C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\FRS_Child_NewID_HBW_111507.xls


--
-- For First Responders, can use this query to get final values from item_usage, letting us bypass data_element
-- 

    @TableGenerator(name="V1_Instrument_Session_Generator", pkColumnValue="V1_Instrument_Session", table="SEQUENCE", pkColumnName="SEQ_NAME", valueColumnName="SEQ_COUNT", allocationSize=1)
    @Id
    @GeneratedValue(strategy=GenerationType.TABLE, generator="V1_Instrument_Session_Generator")
        
    @TableGenerator(name="V1_Item_Usage_Generator", pkColumnValue="V1_Item_Usage", table="SEQUENCE", pkColumnName="SEQ_NAME", valueColumnName="SEQ_COUNT", allocationSize=50)
    @Id
    @GeneratedValue(strategy=GenerationType.TABLE, generator="V1_Item_Usage_Generator")  
    
    @TableGenerator(name="V1_Data_Element_Generator", pkColumnValue="V1_Data_Element", table="SEQUENCE", pkColumnName="SEQ_NAME", valueColumnName="SEQ_COUNT", allocationSize=500)
    @Id
    @GeneratedValue(strategy=GenerationType.TABLE, generator="V1_Data_Element_Generator")      

    
    <properties>
      <property name="toplink.jdbc.user" value="@@DB.USERNAME@@"/>
      <property name="toplink.jdbc.password" value="@@DB.PASSWORD@@"/>
      <property name="toplink.jdbc.url" value="@@DB.URL@@"/>
      <property name="toplink.jdbc.driver" value="@@DB.DRIVER@@"/>
      <property name="toplink.logging.level" value="@@DB.LOGGING@@"/>
    </properties>    
    
[ ] Email these queries to George
--
-- Query master database for InstrumentSessionID of each responseID.
-- v1InstrumentSession_ID can be the key for drilling into the most current data for that response
--
select distinct answerCode as respID, v1InstrumentSession_ID
from v1_item_usage
where v1ItemUsage_ID in 
	(select a.v1ItemUsage_Id from 
		(select max(v1ItemUsage_Id) as v1ItemUsage_Id from v1_item_usage where  varName = 'respID' group by v1InstrumentSession_ID, VarName) as a
	)
order by v1InstrumentSession_ID

--
-- Query details of for a particular respondant
--
select VarName, dataElementSequence, displayNum, languageCode, questionAsAsked, answerCode, answerString, time_stamp, itemVisits, comments
from v1_item_usage
where v1ItemUsage_ID in 
	(select a.v1ItemUsage_Id from 
		(select VarName, max(v1ItemUsage_Id) as v1ItemUsage_Id from v1_item_usage where  v1InstrumentSession_ID = 1 and VarName not like '_tmp%' group by VarName) as a
	)
order by dataElementSequence

--
-- New query, off of Data_Element table
--

--
-- Query master database for InstrumentSessionID of each responseID.
-- v1InstrumentSession_ID can be the key for drilling into the most current data for that response
--
select answerCode as respID, v1InstrumentSession_ID
from v1_data_element
where varName = 'respID'
group by v1InstrumentSession_ID
order by respID;

--
-- Get most recent, non-null, non-"_tmp" data from a specific instance (V1InstrumentSession_ID)
--
select VarName, DataElementSequence, GroupNum, DisplayNum, LanguageCode, QuestionAsAsked, AnswerCode, AnswerString, ItemVisits, Comments
from v1_data_element
where 
	V1InstrumentSession_ID = 1 and
	VarName not like '_tmp%' and AnswerCode not like '*UNASKED*'
order by DataElementSequence;


---
--- 11/20/2007 --
--
What is lift to replace Datum with Data_Element so that Data_Element is unit of analysis in DialogixParser?

Affected Classes:
AnswerChoice
Datum
DatumMath
Evidence?
Node?
Parser
ParseError?
QSortAlgorithm (not used)
Value?

DialogixParser - what is tightly coupled?
(1) Triceps
(2) triceps.get() -- 3 messages - stack_underflow, undefined_variable, unterminated_escaped_character -- so can modularize this
(3) Datum.getInstance(triceps,Datum.INVALID)	-- do we really need Instance-level creation anymore?  Can't we just set NullFlavorr to INVALID?
(4) triceps.getEvidence().set(String varName, Datum value);	=> pass InstrumentSession to .parse()?  This is TimingCalculator.set(VarName, Data_Element)? - only if can replace Datum with Data_Element
(5) triceps.getEvidence.getDatum(String varName);	=> TimingCalculator. - retrieve DataElement by name
(6) triceps.getEvidence().function(func.image, params, func.beginLine, func.beginColumn)	-- externalize functions?  How?
(7) triceps.getEvidence().getParam(set2.get(i)) -- what does this do? (344) - part of inListOp() - gets data_element, or data_element by name
(8) new Datum(triceps, String value, DataType {String, Number} -- returns a value of type DataType
(9) new Datum(triceps, true) -- returns a Boolean

DatumMath
(1) uses Datum.dateValue(), doubleValue(), booleanValue(), and stringValue() -- so data_element needs those types and options
(2) does not uses triceps.* - so just a pass-through to Datum

Datum
(1) Uses of triceps:  parseNumber(), parseDate(), get({Please_answer_this_question, please_enter_a})
(2) All formatting can be done externally?

Value
- Binds a Node to a Datum

---
-- Notes for Java-version of PHP (11/26/07)
--

-- Instruments  with data
select InstrumentVersionName, count(V1InstrumentSession_ID) as Instances, NumVars,  NumGroups, sum(Finished) as NumFinished
from v1_instrument_session
group by InstrumentVersionName
order by InstrumentVersionName

-- Instances of an InstrumentVersion
select V1InstrumentSession_ID, InstrumentVersionName, StartTime, LastAccessTime, (LastAccessTime -  StartTime) as Duration, DisplayNum as NumPageViews, CurrentGroup, LanguageCode, MaxGroup, Finished, ActionType as  LastAction
from v1_instrument_session
order by InstrumentVersionName, StartTime

-- View final results
-- [ ] Mangaement - let users select Regex of what to exclude

select VarName, DataElementSequence, GroupNum, DisplayNum, LanguageCode, QuestionAsAsked, AnswerCode, AnswerString, ItemVisits, Comments
from v1_data_element
where 
	V1InstrumentSession_ID = 1 and
	VarName not like '_tmp%' and AnswerCode not like '*UNASKED*'
order by DataElementSequence;

-- View history of views

select ItemUsageSequence, VarName, DataElementSequence, GroupNum, DisplayNum, LanguageCode, QuestionAsAsked, AnswerCode, AnswerString, ItemVisits, Comments
from v1_item_usage
where 
	V1InstrumentSession_ID = 1 
order by ItemUsageSequence;

--
-- 11/27/2007
-- 
Priorities:
(1) Port Dialogix to J2EE/Oracle so OMH has option to host it
(2) Backup is to have Dialogix hosted (J2EE/MySQL) elsewhere
(3) Start with V1 model, since works.  V6 model is better, but needs more testing
(4) Once have hosting solution (OMH and/or external), migrate current production studies (e.g. CET and Demos) to new platform; at which point can turn-off existing system?
(5) Back-load old data to new site so can fully turn-off/recycle existing hardware
(6) May need minimal management interfaces to ensure  access to data, AppServer, etc. on new platform.
(7) Once OMH has operational system, push forward with Version 6 model, JRuby, etc.


Action Items for George:
(1) Port Dialogix6 (with Dialogix1Model and optionally full Dialogix6 model) to Oracle
	- Works for MySQL
	- Oracle generating some CLOB errors - need to be clear in Entities what type of Lob needed
(2) Port code to J2EE (so can work with Oracle or J2EE) [DONE]
(3) Stress-test the code (memory leaks, concurrency issues, performance)
(Amit) Deploy to OMH servers
(Amit) Stress test with LoadRunner
(Tom) Check acceptability of SAS-based data access vs. Management Layer
(Tom) Present to Chip re suitability for OMH-based data collection -- e.g. screening  instruments, AOT?
(4) Debug Dialogix6 model to ensure successfully and efficiently loads; that InstrumentSessions work; and that no worse for memory leaks, etc.
(5) Explore JRuby as next-generation Front-End
  (a) upload tool
  (b) management layer
(Tom) Get feedback from end-users on needs (e.g. George Musa)

Action Items for Tom
(1) Collect / Clean Wave7 data (Perl) [need to  re-load 12 interviews]
(2) Post AutoPIDS to old server [DONE]
(3) Evaluate Perl for upload to old data model (back-loading  data) [DEFER]
  - should I run Perl against RawData Table (can I extract true TotalDuration, PageDuration, etc. from it?), or re-process raw jar files?
  - will RawData give me AnswerCode and AnswerString?
  - Perl to compute instrument name and version (and MD5 hash) - so can create InstrumentSession table - may want to use Hex MD5 hash rather than Unicode.
  - ? Convert LangNum from integer to 2 char (from whence do I get this?  Full list of instruments? - if so, have to pre-process them
  - Should I try to load instruments into V6 model directly rather than via upload -- NO, but do save as UTF-16
  - make table of instances to convert to InstrumentSessions - there are currently 90,000 instances
  

-- 
-- 12/05/2007 Notes
--
(1) Successfully re-added Version 2 data model (e.g. 42 tables), using J2EE
(2) DialogixConstants (renamed to org.dialogix.session.DialogixEntitiesFacade) now works well when all of the em.persist calls are commented out (opposite of our strategy).
(3) The V1 data model works for collecting data
  [ ] -- but RESERVED words are not updated in V1DataElement
(4) Successfully loaded the following:  
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\SF-36.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\English-Russian-French-Hebrew-Demo.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\English-Russian-French-Hebrew-Demo2.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\PHQ.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Test2.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\ROSI.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Adult Needs and Strengths Assessment (ANSA).xls	
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\AUDIT - Alcohol Use Disorders Identification Test- Interview Version.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Blessed Dementia Scale.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Brief Psychiatric Rating Scale (BPRS) Version 4.0.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\California Quality of Life (CA-QOL).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\CAGE.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Child and Adolescent Needs and Strengths (CANS-MH).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Geriatric Depression Scale.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Mental Health Recovery Measure (MHRM).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\MHSIP Adult Consumer Survey (Draft Version 1.2, February 17, 2006) - Email Format.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Draft MHSIP Consumer Youth Survey For Families (YSS-F, 2006) - rapid entry.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Ohio Mental Health Consumer Outcomes System Ohio Youth Problem, Functioning, and Satisfaction Scales.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Ohio Mental Health Consumer Outcomes System Ohio Youth Problem, Functioning, And Satisfaction Scales W.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Patient Health Questionnaire (PHQ-9).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Physical Self Maintenance Scale (PSMS) -- Patient version.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Symptom Checklist-90-R (SCL-90-R) version SCL-10-R.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\SOCRATES v8.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Symptom Checklist-90-R (SCL-90-R) SCL-6.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\The Making Decisions Empowerment Scale.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\The Caregiver Strain Index.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Symptom Distress Scale (adapted from SCL-90 and BSI).xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\AutoMEQ-SA.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\FRS_Child_NewID_HBW_111507.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\DISC-combined.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\Tutorial.xls


(4b) Had trouble loading  the following:
	
(5) Restore is properly retrieving a prior session
(6) Successfully loading any instrument for which V2 database were accurately created.

[ ] Apelon.xml files - they are repeating some entries - e.g. concept answers and associations between the questions and answers
[DONE] Refactor all logging?

--
-- 12/11/07
--
[ ] Test whether should overwrite global variable in DialogixV1TimingCalculator on line 275

Debugging of revampped DialogixTimingCalculator
[ ] responseLatency
[ ] responseDuration
[ ] If *NA*, should QuestionAsAsked be cleared?
[ ] PageUsage.networkDuration - why negative?
[DONE] PageUsage.vacillation - why null? What should it be? - because based upon GroupNum (and visits to pageGroup)
[DONE] CurrentGroup seems to be CurrentStep -- TRUE  - should we have CurrentStep and CurrentGroup (different restore implications)

	
Should DataElement simply be a pointer to most recent entry in ItemUsage?  If so, then ItemUsage would include *UNASKED*

[DONE] Consolidate Sequence Generator tables
[DONE] Set pageVacillation to PageVisit - just use HashMap<String,Integer> of GroupNum

**
[ ] Shouldn't QuestionAsAsked be set BEFORE sending request to user?  This way always capture what was seen on last page by user.  This is then updated with responses.
  [ ] May require an interface at CollectNext Nodes (before WriteNode)
[ ] Add writeReserved
[DONE] NullFlavorID set to 1 for *NA* - should be 2?
[. ] pageVisits - Null for "init" - fix this.  Should it start at 0 (being set to 0 at first visit)

[ ] Copy all instrument files, ensuring that each have title, major & minor version, & list of languages. Keep full path (since can drop full path into LoadExcel.vm)
[ ] Convert all to Excel (write function to load from TSV to Excel and re-save (or load, then pass workbook to LoadExcel?)
[DONE] Create DialogixPerl repository on CVS so keep it synced separate from Java

[DONE] Debug AnswerList issue
[ ] Reserved Words?
[ ] Annotate (TODO) other load issues which need to be finalized
[ ] Replace VersionIF and related @@ variables with loadable properties.

[ ] ?? Create single Apelon exporter for all instruments (off single heirarchy) - or selected subset of them?

[DONE] Should there be stateless beans for running application (DialogixTimingCalculator) and stateful for loading instruments (InstrumentExcelLoader)?
[DONE] Occassionally throwing EJB errors when there is a NonUniqueResultException.  Cheat by always getting List and pick first element?

ActiveRecord::Base.pluralize_table_names=false
set_primary_key('DialogixUser_ID')
:foreign_key => 'DialogixUser_ID' - 

[DONE] Convert all Log4J logging to java.util.logging - what are implications for logging to files?
[DONE] Conditionally compile out all file-system writes to maximize portability of war

/home/tmw/cet_instruments/AutoMEQ-SA.xls
/home/tmw/cet_instruments/AutoMEQ-SA-irb.xls
/home/tmw/cet_instruments/AutoPIDS-SA.xls
/home/tmw/cet_instruments/AutoSIGH-rev-04-10.xls
/home/tmw/cet_instruments/English-Russian-French-Hebrew-Demo.xls

--
-- 12/19/2007 To Dos
--
[DONE] Rename FirstResp to Dialogix
[DONE] Conditionally remove all file writing, other than via LoadExcel.vm (in hopes of removing memory leak)
[DONE] Fix missing "Thank you" notice at end
[DONE] pageusage - add IP address?
[DONE] session - add most recent IP?
[DONE] pageusage.ToGroupNum where Status = init - is using step, not Group#
[ ] Reserved words in full model?
[ ] re-make instruments local to project, including via LoadExcel.vm (later)
[DONE] test AutoMEQ instruments
[ ] Try to write outbound questions before sending them (so know what was asked in case lose last session)
[DONE] Debug *Invalid* in AutoMEQ report (possibly convert to showTable()s - seems to be a nested parser, so clashing?
[DONE] Confirm properly loading Default answers (e.g. for memo fields) - done for File - fix for Excel
[DONE] Modify LoadExcel for NoDB to use Array and write all data out to flat file  (so has default values)
[ ] Fix AutoSIGH - it's missing some grouping criteria, and shouldn't use HEADER command as it does
[ ] When loading, allow for same major/minor version, but create custom internal version # based upon hash - otherwise will be pain to keep changing version #s
[DONE] restore usage-type logging to log file (as FINE)
[DONE] Also re-expose Errors within Evidence?
[DONE] Add compilation of .jjt file to -precompile?

C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\English-Russian-French-Hebrew-Demo.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\AutoMEQ-SA.xls
	C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\AutoMEQ-SA-irb.xls
	C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\AutoPIDS-SA.xls
	C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\AutoSIGH-rev-04-10.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\FRS_Adult_122007.xls
c:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\JavascriptTest.xls

	
-- Find all existing instruments off of servers
find /usr/local/dialogix/webapps/ -iregex ".*\.txt" -print | grep schedules > /home/tmw/dialogix_instruments.lst
find /usr/local/dialogix/webapps/ -iregex ".*\.jar" -print | grep schedules >> /home/tmw/dialogix_instruments.lst 
find /usr/local/dialogix7777/tomcat/webapps/ -iregex ".*\.txt" -print | grep schedules >> /home/tmw/dialogix_instruments.lst 
find /usr/local/dialogix7777/tomcat/webapps/ -iregex ".*\.jar" -print | grep schedules >> /home/tmw/dialogix_instruments.lst 
find /usr/local/tomcat554/webapps/ -iregex ".*\.txt" -print | grep schedules >> /home/tmw/dialogix_instruments.lst 
find /usr/local/tomcat554/webapps/ -iregex ".*\.jar" -print | grep schedules >> /home/tmw/dialogix_instruments.lst 
tar czvf /home/tmw/dialogix_instruments.tgz -T /home/tmw/dialogix_instruments.lst

--
-- 12/21/2007
--
George Notes

(1) e.g. hard-coded 
(2) FLOPPY_DIR - available in schedule, but doesn't change where things are stored
(3) OE datatype - (open ended) - complex so that has text, but then can have code (currently takes 3 lines of code) [so like Text datatype - rather than prefixing variable name]
(4) Vista - none using Xampp services
 
Administration Views

--
-- 12/21/07 Lingering Issues
-- 
[ ] data_element.responseLatency, responseDuration

Glassfish:
Starting:
sudo /usr/local/glassfish/bin/asadmin start-domain domain1

--
-- All instruments
--
/home/tmw/cet_instruments/AutoMEQ-SA-irb.xls
/home/tmw/cet_instruments/AutoMEQ-SA.xls
/home/tmw/cet_instruments/AutoPIDS-SA.xls
/home/tmw/cet_instruments/AutoSIGH-rev-04-10.xls
/home/tmw/cet_instruments/English-Russian-French-Hebrew-Demo.xls
/home/tmw/cet_instruments/PHQ.xls
/home/tmw/cet_instruments/Patient Health Questionnaire (PHQ-9).xls

http://www.dialogix.org:8888/Dialogix/servlet/Dialogix?schedule=/usr/local/dialogix3/instruments/AutoMEQ-SA-irb.xls_0.txt&DIRECTIVE=START
http://www.dialogix.org:8888/Dialogix/servlet/Dialogix?schedule=/usr/local/dialogix3/instruments/AutoMEQ-SA.xls_1.txt&DIRECTIVE=START
http://www.dialogix.org:8888/Dialogix/servlet/Dialogix?schedule=/usr/local/dialogix3/instruments/AutoPIDS-SA.xls_2.txt&DIRECTIVE=START
http://www.dialogix.org:8888/Dialogix/servlet/Dialogix?schedule=/usr/local/dialogix3/instruments/AutoSIGH-rev-04-10.xls_3.txt&DIRECTIVE=START
http://www.dialogix.org:8888/Dialogix/servlet/Dialogix?schedule=/usr/local/dialogix3/instruments/English-Russian-French-Hebrew-Demo.xls_4.txt&DIRECTIVE=START
http://www.dialogix.org:8888/Dialogix/servlet/Dialogix?schedule=/usr/local/dialogix3/instruments/PHQ.xls_5.txt&DIRECTIVE=START
http://www.dialogix.org:8888/Dialogix/servlet/Dialogix?schedule=/usr/local/dialogix3/instruments/Patient Health Questionnaire (PHQ-9).xls_6.txt&DIRECTIVE=START


/home/tmw/cet_instruments/AutoMEQ-SA-irb.xls
/home/tmw/cet_instruments/AutoMEQ-SA.xls
/home/tmw/cet_instruments/AutoPIDS-SA.xls
/home/tmw/cet_instruments/AutoSIGH-rev-04-10.xls
/home/tmw/cet_instruments/English-Russian-French-Hebrew-Demo.xls
/home/tmw/cet_instruments/PHQ.xls
/home/tmw/cet_instruments/Patient Health Questionnaire (PHQ-9).xls
/home/tmw/cet_instruments/Adult Needs and Strengths Assessment (ANSA).xls
/home/tmw/cet_instruments/Alcohol Use Scale (AUS).xls
/home/tmw/cet_instruments/AUDIT - Alcohol Use Disorders Identification Test- Interview Version.xls
/home/tmw/cet_instruments/Blessed Dementia Scale.xls
/home/tmw/cet_instruments/Brief Psychiatric Rating Scale (BPRS) Version 4.0.xls
/home/tmw/cet_instruments/CAGE.xls
/home/tmw/cet_instruments/California Quality of Life (CA-QOL).xls
/home/tmw/cet_instruments/Child and Adolescent Needs and Strengths (CANS-MH).xls
/home/tmw/cet_instruments/DISC-combined.xls
/home/tmw/cet_instruments/Draft MHSIP Consumer Youth Survey For Families (YSS-F, 2006) - rapid entry.xls
/home/tmw/cet_instruments/Drug Use Scale.xls
/home/tmw/cet_instruments/English-Russian-French-Hebrew-Demo2.xls
/home/tmw/cet_instruments/FRS_Adult_122007.xls
/home/tmw/cet_instruments/FRS_Adult_NewID_HBW_111507.xls
/home/tmw/cet_instruments/FRS_Child_122007.xls
/home/tmw/cet_instruments/FRS_Child_NewID_HBW_111507.xls
/home/tmw/cet_instruments/Geriatric Depression Scale.xls
/home/tmw/cet_instruments/Mental Health Recovery Measure (MHRM).xls
/home/tmw/cet_instruments/MHSIP Adult Consumer Survey (Draft Version 1.2, February 17, 2006) - Email Format.xls
/home/tmw/cet_instruments/Ohio Mental Health Consumer Outcomes System Ohio Youth Problem, Functioning, And Satisfaction Scales W.xls
/home/tmw/cet_instruments/Ohio Mental Health Consumer Outcomes System Ohio Youth Problem, Functioning, and Satisfaction Scales.xls
/home/tmw/cet_instruments/Ohio Mental Health Consumer Outcomes System Ohio Youth Problem, Parent Rating.xls
/home/tmw/cet_instruments/Patient Health Questionnaire (PHQ-9).xls
/home/tmw/cet_instruments/Physical Self Maintenance Scale (PSMS) -- Patient version.xls
/home/tmw/cet_instruments/ROSI.xls
/home/tmw/cet_instruments/SF-36.xls
/home/tmw/cet_instruments/SOCRATES v8.xls
/home/tmw/cet_instruments/Symptom Checklist-90-R (SCL-90-R) SCL-6.xls
/home/tmw/cet_instruments/Symptom Checklist-90-R (SCL-90-R) version SCL-10-R.xls
/home/tmw/cet_instruments/Symptom Distress Scale (adapted from SCL-90 and BSI).xls
/home/tmw/cet_instruments/Test.xls
/home/tmw/cet_instruments/Test2.xls
/home/tmw/cet_instruments/Test3.xls
/home/tmw/cet_instruments/The Caregiver Strain Index.xls
/home/tmw/cet_instruments/The Making Decisions Empowerment Scale.xls

[DONE] Not working with IE?

--
-- 12/28/2007
-- 
[DONE] Try refactoring so that V1ItemUsage and V1DataElement normalized
	- Note, works fine as long as don't try to writeReserved (get  EJB Null Pointers) - why?
[ ] Try refactoring so that ItemUsage and DataElement normalized
[ ] Compile AutoMEQ site so that only uses one of two models (to improve performance)?
[ ] Test using LoadRunner?
http://localhost:7070/Dialogix/servlet/Dialogix?schedule=/usr/local/dialogix3/instruments/English-Russian-French-Hebrew-Demo.xls_0.txt&DIRECTIVE=START
http://localhost:7070/Dialogix/servlet/Dialogix?schedule=/usr/local/dialogix3/instruments/JavascriptTest.xls_0.txt&DIRECTIVE=START

--
-- 12/28/2007
--
[ ] Try to write outbound questions before sending them (so know what was asked in case lose last session)
[DONE] data_element.responseLatency, responseDuration
[ ] When loading, allow for same major/minor version, but create custom internal version # based upon hash - otherwise will be pain to keep changing version #s

select * from page_usage_event order by page_usage_id, PageUsageEventSequence

--
-- 12/30/2007
--
[DONE] Fix Javascript so works with newer browsers, especially IE
[DONE] Add ItemEventBean to track response latency and duration
[ ] Replace Images for comment, refused, etc. with Text buttons whose style can change to indicated whether selected, and can use language-sepcific text for each!

document.images - collection of <img> tags on a form
String.fromCharCode(event.charCode ? event.charCode : event.keyCode);

--
-- 1/3/08
--
target.selectedIndex not working for radio buttons - so values are correct in item_usage, but may not be correct in the pageUsageEvent history.  However, the IE buttons do work!

--
-- 1/4/08 Lingering ToDos
-- 
Mandatory
[. ] Stress test, and refine model as needed to ensure proper scalability
[. ] Deploy to www.dialogix.org
[ ] test whether item.responseLatency & responseDuration are working correctly for IE and Mozilla (test all timing information - still seems off)
[ ] confirm all browsers supported (e.g.  Opera, Safari)
[ ] port to Oracle, with stress testing
[ ] Stress test with minimal database logging? (e.g. for CET - totally anonymous)
[DONE] Toplink issue of update vs. insert (unit of work?)
[DONE] Add pre & post AnswerCode and AnswerString to track how values were changed.  Ditto recording time asked vs. time answered?

Highly Desirable
[. ] Shouldn't QuestionAsAsked be set BEFORE sending request to user?  This way always capture what was seen on last page by user.  This is then updated with responses.
[DONE] writeNodePreAsking() - test for V1 model first, since  V2 model not normalized and uses  CloneDataElement()
[DONE] Is not updating properly in V1 model - so get question before asked, but answer never recorded - why not?!  Same problem as with reserved?  DirtyFlag?
[DONE] Load all instruments based upon extension (.jar, .txt, or .xls) - just load into array
[DONE] Detect identifical instruments based upon InstrumentHash
[ ] Create single Apelon exporter for all instruments (off single heirarchy) - or selected subset of them?
[ ] Apelon.xml files - they are repeating some entries - e.g. concept answers and associations between the questions and answers
[ ] Replace VersionIF and related @@ variables with loadable properties. - @Resources
[DONE] When loading, allow for same major/minor version, but create custom internal version # based upon hash - otherwise will be pain to keep changing version #s
[ ] Try refactoring so that ItemUsage and DataElement normalized
[ ] Consolidate DialogixTimer and V1DialogixTimer to avoid double processing (needed?)
[DONE] Ensure that "Non-Unique Results" errors appear in Error log - there are 11 cases - how can they be created as InstrumentLoadErrors?  Throw an error?
[DONE] Fix Error reporting table so not misaligned
[ ] Assess "Mismatch across languages" errors - sign of imporper normalization? - will want to know ID of of AnswerList which is trying to be reset
[DONE] Ensure local install has enough memory
[ ] Replace Images for comment, refused, etc. with Text buttons whose style can change to indicated whether selected, and can use language-sepcific text for each!
[DONE] V1PageUsage - record action for each page (so know whether pressed next, previous, etc.)
[ ] PageUsage - test actionType - seems to always be "next" even when really a language switch or previous
[ ] Model extra tables for study management
[ ] Model org.dialogix.parser so can run navigation straight off of data model (eliminate need for flat files)
[DONE] Remove dependency upon Velocity, migrating to JSP
[DONE] Plan meeting with Pat Cohen (what documents should I send her)?


Optional Tasks
[ ] Identify problem with duplicate entries in AnswerList (and others)?
[ ] CCD Writer using SNOMED mapping codes
[ ] Map to XForms
[ ] Map to VoiceXML
[ ] Review ISO 11179 metadata issues - should any be  added to what we have?
[ ] Map to eDCI model
[ ] Add AuthorizedUsers table to Dialogix5
[.] RESERVED Words (partial for V1)
[DONE] Clean interface to TimingCalculator so not dependent upon Node and Datum
[DONE] Remove dependency upon OroMatcher in new project
[DONE] Re-organize project packages to show old vs. new code


Lingering WishList
[ ] Replace wave6users table? (Study - user, instrument - will then point to InstrumentSession?)
[ ] What is lift to remove Datum and use DataElement within Parser?
[ ] Upload instruments via Upload button
[ ] Consider moving DialogixTimingCalculator to Session Bean (lets us create Web Service via NetBeans)
[ ] Create WriteNode() equivalent which doesn't use legacy Node and Datum elements
[ ] Create Navigation methods which get collection of InstrumentContent for next, previous, etc.

Ruby (George)
[ ] Replicate PHP code
	[ ] http://www.dialogix.org/dev/InstrumentSearch.php - InstrumentName, Version, NumLanguages, Instances, NumVars, NumQuestions, NumEquations, NumBranches, NumTailorings
		- click on # instances to see summary of each instance (e.g. http://www.dialogix.org/dev/InstanceSearch.php)
  [ ] http://www.dialogix.org/dev/InstanceSearch.php - Session#, StartDate, Finished, NumPagesViewed, Duration (hh:mm:ss) - NO, use instrument_session_controller.rb
  	- click to get to item_usage_controller.rb - add DisplayNum as first column; and make QuestionAsAsked 
  [ ] Instrument Logic File
  	http://www.dialogix.org/dev/InstrumentLogicFile.php?Instrument=AUDIT_v._n13_f6b0685a03c39dcd88f4336fa5a6d333
  	
		groupNum:   		InstrumentContent.GroupNum
		Name:						InstrumentContent.var_name_id.VarName
		Relevance:			InstrumentContent.Relevance
		Question:				InstrumentContent.item_id.question_id.question_localized_id.QuestionString where LanguageCode = 'en'
		AnswerOptions:	InstrumentContent.item_id.answer_list_id.answer_list_denormalized.AnswerListDenormalizedString (parse this)
					OR:				InstrumentContent.item_id.answer_list_id.answer_list_content.AnswerOrder
										InstrumentContent.item_id.answer_list_id.answer_list_content.AnswerCode
										InstrumentContent.item_id.answer_list_id.answer_list_content.answer_id.answer_list_denormalized.AnswerListDenormalizedString (where LanguageCode en)
  	DisplayStyle:		InstrumentContent.display_type_id.display_type.DisplayType
  	
[ ] Study Management
	[ ] Upload Instrument - Call a Dialogix Web Service
	[ ] Retrieve all data for a given instrument


--
-- 1/8/08 Track down normalizion error messages
--

Normalized Errors
[.] (1) Item - too many validations with blank, blank, NULL
[ ] (2) Mismatch across languages - needs keys to track down data

use utf8_bin to fix duplicate key problem
within  phpMyAdmin, set show_blob to true for the config.inc.php

[ ] AnswerListDenormalized -  may need another object for full AnswerList with all translations - that way can create new one if add additional translations, since might change meaning of item?


--
-- Test load from legacy .txt and .jar files
--
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\English-Russian-French-Hebrew-Demo.xls
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\introduction.txt
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\SCID-II.jar
C:\cvs5\Dialogix2007\Dialogix_J2EE\Dialogix\docs\BYS-Adult.jar

[ ] Validation - fewer null ones, but still has at least one per usage (should't it retrieve such a null one properly)?

[ ] New Entities added for SourceContent -- could let us eliminate Source Files (could re-build from database), but unless can find way to lazily load the collection, may take up lots of extra space

--
-- 1/15/08 Prep for Meeting with Chip
--

--
-- 1/15/08 - Notes from George
--
Check Interviews
	Load Jar
		Var, QuestionAsAsked, AnswerCode, [AnswerString], Comments, Time
Backup Interviews	
	Copies Jar to server
	
--
-- 1/16/08 - Test deployment of new model to Tomcat
--
(1) Can't create new DialogixWeb application with same source path as Dialogix; and can't include that project in a new web application
(2) Can create DialogixLaptop from existing soruces, but seemed to mess up build of main project
(3) Main problem is that although can include TopLink, JNDI lookups fail when deploying ejbs to Tomcat.  
[ ] Conditionally use direct EntityManager lookup for Tomcat vs. LocalEJB for Glassfish?

--
-- 1/17/08 
--
[DONE] Add JSP listing instruments
[DONE] Add JSP to generate SPSS import file
[DONE] Add JSP to exract data

select 
	de.instrument_session_id,
	de.data_element_sequence,
	de.var_name_id,
	vn.name,
	de.answer_code,
	de.answer_string,
	de.null_flavor_id
from data_elements de, var_names vn
where 
	de.var_name_id = vn.var_name_id and
	de.instrument_session_id in
		(select instrument_session_id from instrument_sessions where instrument_version_id = 6)
order by de.instrument_session_id, de.data_element_sequence;

--
-- 1/18/08-1/21/08
--
To Do

List Instruments (title, # sessions)
	Link: Download => DataExporter.jsp?id= letting you:
		(a) set values for each NullFlavor
		(b) set regex search criteria for variable names (to exclude ones matching that pattern)
		(c) specify output order:  asAsked vs. variable name
		(d) checkboxes for {generate variable labels, value labels)
		(e) ?language (from drop-down of list available to  instrument)
		(f) checkbox - generate frequency distribution
		(g) SAS and/or SPSS
		
1/21/08 - Data Export working, except for the following:
[DONE] Check all permutations of select boxes in JSP vs. output - seems that not all are persisting across pages
[DONE] Find way to keep current instrument selection from drop-down list (ditto for order in which columns should appear)
[ ] Text SQL on Oracle (since had to hand-roll it)
[DONE] Create SAS export
[ ] Save all selected options to a .zip file (rather than printing to screen - or optionally print to screen so Chip can see it, but also have download)
[DONE] Create Frequency Distribution SPSS scripts
[ ] May need to use StringWriters rather than StringBuffer to avoid out of memory errors for large files

OTHER on wish list:
[DONE] Create PI view of instrument using JSP?
[DONE] Optionally set language Code for HMTL output
[ ] Create Session view of instrument using JSP
		
--
-- 1/23/08
--
[ ] DataExporter - support export to winzip (requires different source output - open new window with type="application/zip" (what is proper syntax?)
[ ] DataExporter - set option to generate WinZip 
[ ] DataExporter - output to TSV
[ ] Frequency distribution for SAS - proc freq data=work.summary; table x; table y; run;
[ ] Replicate PHP functionality - ideally testing jMaki or JSP functionality? - for convenience, use simple JSP

Instruments
	UserView.jsp:  Name, hashMap data => goal: launch/run
	ResearcherView:  Name, version, #sessions => goal:definitions, IRB, PI views
Results	
	ResultsView: Name, version, #sessions, toXForms, toVoiceXML, 
	SessionsView: ID, status, details, 
	V1SessionsView:
	
	
--
-- 1/29/08
--
[DONE] Add InstrumentLoader.jsp to receive submissions from Ruby
[DONE] Create Test page for the above

intro	1	This will test uploads from Ruby with one question per page		nothing
double	1	Enter a number		double
gender	1	What is your sex?		list|1|Female|0|Male|2|Other
state	1	Where do you live?		combo|1|New York|2|California|3|Florida|4|Oregon|5|other
genome	1	What is your genotype?		radio|1|XX|2|XY|3|X0|4|XXY
yesno	1	Is this helpful?		check|1|Yes
password	1	Enter your pasword		password
comments	1	What do you think?		memo
thanks	1	Thanks!		nothing

